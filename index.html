<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Vergel | Frutas y Verduras</title>
    <style>
        /* --- ESTILOS VISUALES --- */
        :root {
            --naranja-logo: #F39C12;
            --verde-logo: #C0D92E;
            --verde-oscuro: #2E7D32;
            --blanco: #ffffff;
            --gris-claro: #f4f4f4;
            --texto: #333;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--gris-claro); color: var(--texto); }

        /* Navegaci√≥n */
        nav { background: var(--naranja-logo); padding: 1rem 2rem; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .logo-text { font-family: 'Brush Script MT', cursive; font-size: 2rem; color: var(--verde-logo); text-shadow: 1px 1px 0 #000; text-decoration: none; }
        .nav-links { display: flex; gap: 15px; }
        .nav-btn { background: transparent; border: none; color: white; font-weight: bold; font-size: 1rem; cursor: pointer; padding: 8px 15px; border-radius: 20px; transition: 0.3s; }
        .nav-btn:hover, .nav-btn.active { background: var(--verde-logo); color: #000; }

        /* Secciones */
        section { display: none; padding: 30px 20px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.5s ease-in-out; }
        #home { display: block; } 
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tarjetas */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: var(--blanco); border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 5px solid var(--naranja-logo); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 20px; text-align: center; }
        
        /* Botones */
        .btn-action { background-color: var(--naranja-logo); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-action:hover { background-color: var(--verde-oscuro); }
        .btn-sm { background:#ddd; border:none; width:30px; height:30px; border-radius:50%; font-weight:bold; cursor:pointer; }
        .btn-sm:hover { background: var(--verde-logo); }

        .hero { background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1610832958506-aa56368176cf'); background-size: cover; color: white; text-align: center; padding: 80px 20px; border-radius: 0 0 20px 20px; margin-bottom: 40px; }
    </style>
</head>
<body>

    <nav>
        <a href="#" onclick="navegar('home')" class="logo-text">El Vergel</a>
        <div class="nav-links">
            <button class="nav-btn active" onclick="navegar('home')">Inicio</button>
            <button class="nav-btn" onclick="navegar('pedidos')">Pedidos</button>
            <button class="nav-btn" onclick="navegar('tips')">Tips</button>
            <button class="nav-btn" onclick="navegar('recetas')">Recetas</button>
            <button class="nav-btn" onclick="navegar('contacto')">Contacto</button>
        </div>
    </nav>

    <section id="home">
        <div class="hero"><h1>El Vergel</h1><p>Frescura Natural</p></div>
        <div class="grid-container">
            <div class="card">
                <div class="card-body">
                    <h3>Haz tu Pedido</h3>
                    <p>Frutas y verduras frescas.</p>
                    <button onclick="navegar('pedidos')" class="btn-action">Ir a Pedidos üõí</button>
                </div>
            </div>
            </div>
    </section>

    <section id="pedidos">
        <h2 style="color: var(--naranja-logo);">üì¶ Realiza tu Pedido</h2>
        <div id="productos-grid" class="grid-container">Cargando productos...</div>
    </section>

    <section id="tips"><h2 style="color: var(--naranja-logo);">üí° Tips Saludables</h2><div id="tips-grid" class="grid-container">Pr√≥ximamente...</div></section>
    
    <section id="recetas"><h2 style="color: var(--naranja-logo);">üç≥ Recetas</h2><div id="recetas-grid" class="grid-container">Pr√≥ximamente...</div></section>

    <section id="contacto"><h2 style="color: var(--naranja-logo);">üìû Contacto</h2><div style="text-align:center;">Email: contacto@elvergel.com</div></section>

    <script>
        // ‚ö†Ô∏è PEGA AQU√ç TU URL DE APPS SCRIPT ‚ö†Ô∏è
        const API_URL = 'https://script.google.com/macros/s/AKfycbz1z-YwHC561GFP97iSpsnohBdDIbmxSCZINMh1F3FSjL1xZb4295UdiNThYzbI-bw/exec'; 

        let carrito = [];
        let productosGlobal = [];

        // 1. NAVEGACI√ìN
        function navegar(seccionId) {
            document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
            const target = document.getElementById(seccionId);
            if(target) target.style.display = 'block';
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const btnActivo = Array.from(document.querySelectorAll('.nav-btn')).find(b => 
                b.innerText.toLowerCase().includes(seccionId === 'home' ? 'inicio' : seccionId)
            );
            if(btnActivo) btnActivo.classList.add('active');
        }

        // 2. CARGA DE DATOS
        window.onload = () => cargarProductos();

        function cargarProductos() {
            fetch(API_URL + '?action=getProductos')
            .then(r => r.json())
            .then(data => {
                productosGlobal = data;
                const container = document.getElementById('productos-grid');
                container.innerHTML = ''; 
                
                data.forEach(p => {
                    if(p.Disponible === "FALSE" || p.Disponible === false) return;

                    // L√ìGICA KG vs UNIDAD
                    const esKilo = p.Unidad.toLowerCase() === 'kg';
                    const paso = esKilo ? 0.1 : 1;
                    const min = esKilo ? 0.1 : 1;

                    // Botones r√°pidos para kg
                    const botonesExtra = esKilo ? `
                        <div style="margin-bottom:10px;">
                            <button onclick="fijarCantidad('${p.ID_Producto}', 0.5)" class="btn-sm">¬Ω</button>
                            <button onclick="fijarCantidad('${p.ID_Producto}', 1)" class="btn-sm">1</button>
                        </div>` : '';

                    const ofertaHTML = (p.Precio_Oferta && p.Minimo_Oferta) ? 
                        `<p style="color:green; font-size:0.9rem;">üî• Oferta: $${p.Precio_Oferta} llevando +${p.Minimo_Oferta} ${p.Unidad}</p>` : '';

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${p.Imagen || 'https://via.placeholder.com/300'}" alt="${p.Nombre}">
                        <div class="card-body">
                            <h3>${p.Nombre}</h3>
                            <p style="color:var(--naranja-logo); font-weight:bold; font-size:1.2rem;">
                                $${p.Precio_Regular} / ${p.Unidad}
                            </p>
                            ${ofertaHTML}
                            ${botonesExtra}
                            <div style="display:flex; justify-content:center; gap:10px; margin-bottom:10px;">
                                <button onclick="cambiarInput('${p.ID_Producto}', -${paso})" class="btn-sm">-</button>
                                <input id="cant-${p.ID_Producto}" type="number" value="${min}" step="${paso}" min="${min}" style="width:50px; text-align:center;">
                                <button onclick="cambiarInput('${p.ID_Producto}', ${paso})" class="btn-sm">+</button>
                            </div>
                            <button onclick="agregar('${p.ID_Producto}')" class="btn-action">Agregar üõí</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            })
            .catch(e => console.log("Error cargando:", e));
        }

        // 3. FUNCIONES DE CARRITO
        function cambiarInput(id, delta) {
            const input = document.getElementById('cant-'+id);
            let val = parseFloat(input.value) + delta;
            if(val < 0.1) val = 0.1;
            input.value = Math.round(val * 100) / 100;
        }
        function fijarCantidad(id, val) { document.getElementById('cant-'+id).value = val; }

        function agregar(id) {
            const prod = productosGlobal.find(p => p.ID_Producto === id);
            const cantidad = parseFloat(document.getElementById('cant-'+id).value);

            // L√ìGICA DE PRECIO Y OFERTA
            let precioFinal = prod.Precio_Regular;
            if (prod.Precio_Oferta && cantidad >= prod.Minimo_Oferta) {
                precioFinal = prod.Precio_Oferta;
                alert(`¬°Oferta aplicada en ${prod.Nombre}!`);
            }

            // Agregar o actualizar carrito
            const existente = carrito.find(item => item.id === id);
            if (existente) {
                existente.cantidad += cantidad;
                // Verificar oferta nuevamente con la nueva cantidad total
                if (prod.Precio_Oferta && existente.cantidad >= prod.Minimo_Oferta) {
                    existente.precio = prod.Precio_Oferta;
                }
            } else {
                carrito.push({
                    id: id,
                    nombre: prod.Nombre,
                    precio: precioFinal,
                    cantidad: cantidad,
                    unidad: prod.Unidad
                });
            }
            alert(`Agregado: ${cantidad} ${prod.Unidad} de ${prod.Nombre}`);
            console.log(carrito);
        }
    </script>
</body>
</html>

